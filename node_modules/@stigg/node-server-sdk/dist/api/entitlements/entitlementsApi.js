"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sdk_1 = require("@stigg/api-client-js/src/generated/sdk");
class EntitlementsApi {
    constructor(client, edgeApiClient, loggerService) {
        this.client = client;
        this.edgeApiClient = edgeApiClient;
        this.loggerService = loggerService;
    }
    async getEntitlements(customerId, resourceId, skipEdge = false, timeout) {
        // fetching entitlements from edge-api instead of graphql-api
        if (this.edgeApiClient && !skipEdge) {
            this.loggerService.debug(`Fetching entitlements from edge`, { customerId, resourceId });
            return this.edgeApiClient.getEntitlements(customerId, resourceId);
        }
        this.loggerService.debug(`Fetching entitlements from api`, { customerId });
        return this.client.query({
            query: sdk_1.GetEntitlementsDocument,
            variables: { query: { customerId, resourceId } },
            fetchPolicy: 'no-cache',
            context: {
                timeout,
            },
        });
    }
    reportUsage(data) {
        return this.client.mutate({
            mutation: sdk_1.ReportUsageDocument,
            variables: { input: data },
            fetchPolicy: 'no-cache',
        });
    }
    reportUsageBulk(input) {
        return this.client.mutate({
            mutation: sdk_1.ReportUsageBulkDocument,
            variables: { input },
            fetchPolicy: 'no-cache',
        });
    }
    reportEvent(data) {
        return this.client.mutate({
            mutation: sdk_1.ReportEventDocument,
            variables: { input: { usageEvents: data } },
            fetchPolicy: 'no-cache',
        });
    }
    subscribeEntitlementsUpdated() {
        return this.client.subscribe({
            query: sdk_1.OnEntitlementsUpdatedDocument,
        });
    }
    subscribeUsageUpdated() {
        return this.client.subscribe({
            query: sdk_1.OnUsageUpdatedDocument,
        });
    }
    subscribePackagePublished() {
        return this.client.subscribe({
            query: sdk_1.OnPackagePublishedDocument,
        });
    }
}
exports.default = EntitlementsApi;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXRsZW1lbnRzQXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2FwaS9lbnRpdGxlbWVudHMvZW50aXRsZW1lbnRzQXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsZ0VBMkJnRDtBQUVoRCxNQUFNLGVBQWU7SUFDbkIsWUFDbUIsTUFBMkMsRUFDM0MsYUFBbUMsRUFDbkMsYUFBNEI7UUFGNUIsV0FBTSxHQUFOLE1BQU0sQ0FBcUM7UUFDM0Msa0JBQWEsR0FBYixhQUFhLENBQXNCO1FBQ25DLGtCQUFhLEdBQWIsYUFBYSxDQUFlO0lBQzVDLENBQUM7SUFFSixLQUFLLENBQUMsZUFBZSxDQUNuQixVQUFrQixFQUNsQixVQUE4QixFQUM5QixRQUFRLEdBQUcsS0FBSyxFQUNoQixPQUFnQjtRQUVoQiw2REFBNkQ7UUFDN0QsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ25DLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxFQUFFLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7WUFDeEYsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7U0FDbkU7UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxnQ0FBZ0MsRUFBRSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFDM0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBc0Q7WUFDNUUsS0FBSyxFQUFFLDZCQUF1QjtZQUM5QixTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEVBQUU7WUFDaEQsV0FBVyxFQUFFLFVBQVU7WUFDdkIsT0FBTyxFQUFFO2dCQUNQLE9BQU87YUFDUjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxXQUFXLENBQUMsSUFBNEI7UUFDdEMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBb0Q7WUFDM0UsUUFBUSxFQUFFLHlCQUFtQjtZQUM3QixTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQzFCLFdBQVcsRUFBRSxVQUFVO1NBQ3hCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxlQUFlLENBQUMsS0FBMkI7UUFDekMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBNEQ7WUFDbkYsUUFBUSxFQUFFLDZCQUF1QjtZQUNqQyxTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUU7WUFDcEIsV0FBVyxFQUFFLFVBQVU7U0FDeEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFdBQVcsQ0FBQyxJQUFtQjtRQUM3QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFvRDtZQUMzRSxRQUFRLEVBQUUseUJBQW1CO1lBQzdCLFNBQVMsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUMzQyxXQUFXLEVBQUUsVUFBVTtTQUN4QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNEJBQTRCO1FBQzFCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQWdGO1lBQzFHLEtBQUssRUFBRSxtQ0FBNkI7U0FDckMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHFCQUFxQjtRQUNuQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFrRTtZQUM1RixLQUFLLEVBQUUsNEJBQXNCO1NBQzlCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx5QkFBeUI7UUFDdkIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBMEU7WUFDcEcsS0FBSyxFQUFFLGdDQUEwQjtTQUNsQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFFRCxrQkFBZSxlQUFlLENBQUMifQ==