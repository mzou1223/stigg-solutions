"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModelMapper = void 0;
const sdk_1 = require("@stigg/api-client-js/src/generated/sdk");
const models_1 = require("../models");
const lodash_1 = require("lodash");
const featureTypes_1 = require("./featureTypes");
const dateUtils_1 = require("./dateUtils");
class ModelMapper {
    constructor() {
        this.mapSlimCustomer = (customer) => {
            return {
                id: customer.refId,
                name: customer.name || undefined,
                email: customer.email || undefined,
                billingId: customer.billingId || undefined,
                createdAt: new Date(customer.createdAt),
                updatedAt: new Date(customer.updatedAt),
                metadata: customer.additionalMetaData,
                awsMarketplaceCustomerId: customer.awsMarketplaceCustomerId,
            };
        };
        this.mapProvisionedCustomer = (graphProvisionedCustomer) => {
            const customer = this.mapSlimCustomer(graphProvisionedCustomer.provisionCustomer.customer);
            const subscription = graphProvisionedCustomer.provisionCustomer.subscription
                ? this.mapSlimSubscription(graphProvisionedCustomer.provisionCustomer.subscription)
                : undefined;
            return {
                customer,
                subscriptionDecisionStrategy: graphProvisionedCustomer.provisionCustomer.subscriptionDecisionStrategy,
                subscription,
            };
        };
        this.mapProvisionedSubscriptionResult = (graphProvisionedSubscriptionResult) => {
            const { provisionSubscription: { subscription, status, checkoutUrl }, } = graphProvisionedSubscriptionResult;
            return {
                subscription: subscription ? this.mapSlimSubscription(subscription) : undefined,
                checkoutUrl: checkoutUrl,
                provisionStatus: status,
            };
        };
        this.mapSlimSubscription = (slimSubscription) => {
            var _a, _b;
            const [planPrice] = slimSubscription.prices || [];
            const { totalPrice } = slimSubscription;
            return {
                id: slimSubscription.refId,
                resource: slimSubscription.resource ? this.mapResource(slimSubscription.resource) : null,
                planId: slimSubscription.plan.refId,
                status: slimSubscription.status,
                addons: ((_a = slimSubscription.addons) === null || _a === void 0 ? void 0 : _a.map((addon) => ({ addonId: addon.addon.refId, quantity: addon.quantity }))) || [],
                addonIds: ((_b = slimSubscription.addons) === null || _b === void 0 ? void 0 : _b.map(({ addon }) => addon.refId)) || [],
                customerId: slimSubscription.customer.refId,
                metadata: slimSubscription.additionalMetaData,
                billingId: slimSubscription.billingId || undefined,
                billingLinkUrl: slimSubscription.billingLinkUrl || undefined,
                latestInvoice: this.mapLatestInvoice(slimSubscription.latestInvoice),
                paymentCollection: slimSubscription.paymentCollection,
                prices: this.getSubscriptionPrices(slimSubscription),
                totalPrice,
                price: planPrice && totalPrice && planPrice.price
                    ? this.mapTotalPrice(planPrice.price, totalPrice, planPrice.usageLimit)
                    : null,
                pricingType: slimSubscription.pricingType,
                effectiveEndDate: (0, dateUtils_1.mapDate)(slimSubscription.effectiveEndDate),
                experimentInfo: (0, lodash_1.omit)(slimSubscription.experimentInfo, '__typename'),
                billingSyncError: slimSubscription.billingSyncError || undefined,
            };
        };
        this.mapApplySubscriptionResults = (graphApplySubscriptionResults, customerId) => {
            const { applySubscription: { subscription }, } = graphApplySubscriptionResults;
            return {
                subscription: subscription
                    ? this.mapSlimSubscription(Object.assign(Object.assign({}, subscription), { customer: { id: '', refId: customerId } }))
                    : undefined,
            };
        };
        this.mapFullCustomer = (customer) => {
            var _a;
            return new models_1.CustomerModel(Object.assign(Object.assign({}, this.mapSlimCustomer(customer)), { alreadyTrialPlans: ((_a = customer.trialedPlans) === null || _a === void 0 ? void 0 : _a.map((x) => {
                    return { planId: x.planRefId, productId: x.productRefId };
                })) || [], hasPaymentMethod: customer.hasPaymentMethod, paymentMethodDetails: this.mapPaymentDetails(customer), subscriptions: (0, lodash_1.map)(customer.subscriptions, (x) => this.mapFullSubscription(x)), coupon: customer.coupon ? this.mapCoupon(customer.coupon) : undefined, promotionalEntitlements: (0, lodash_1.map)(customer.promotionalEntitlements, (x) => this.mapPromotionalEntitlement(x)), experimentInfo: (0, lodash_1.omit)(customer.experimentInfo, '__typename') }));
        };
    }
    mapEntitlement(entitlement, decision, requestedUsage, requestedValues) {
        const { calculatedEntitlement } = entitlement;
        if (!calculatedEntitlement.feature) {
            return this.mapBooleanEntitlement(entitlement, decision);
        }
        const { featureType, meterType } = calculatedEntitlement.feature;
        const isMetered = featureType === sdk_1.FeatureType.Number &&
            (meterType === sdk_1.MeterType.Incremental || meterType === sdk_1.MeterType.Fluctuating);
        switch (featureType) {
            case sdk_1.FeatureType.Boolean:
                return this.mapBooleanEntitlement(entitlement, decision);
            case sdk_1.FeatureType.Enum:
                return this.mapEnumEntitlement(entitlement, decision, requestedValues);
            case sdk_1.FeatureType.Number: {
                return isMetered
                    ? this.mapMeteredEntitlement(entitlement, decision, requestedUsage)
                    : this.mapNumericEntitlement(entitlement, decision);
            }
        }
    }
    mapBooleanEntitlement(entitlement, decision) {
        return {
            type: 'BOOLEAN',
            isFallback: false,
            hasAccess: decision.hasAccess,
            accessDeniedReason: decision.accessDeniedReason,
            feature: entitlement.calculatedEntitlement.feature
                ? Object.assign(Object.assign({}, entitlement.calculatedEntitlement.feature), { isMetered: false }) : undefined,
        };
    }
    mapEnumEntitlement(entitlement, decision, requestedValues) {
        var _a;
        return {
            type: 'ENUM',
            isFallback: false,
            hasAccess: decision.hasAccess,
            accessDeniedReason: decision.accessDeniedReason,
            feature: entitlement.calculatedEntitlement.feature
                ? Object.assign(Object.assign({}, entitlement.calculatedEntitlement.feature), { isMetered: false }) : undefined,
            enumValues: (_a = entitlement.calculatedEntitlement.enumValues) !== null && _a !== void 0 ? _a : [],
            requestedValues,
        };
    }
    mapNumericEntitlement(entitlement, decision) {
        const { hasUnlimitedUsage, usageLimit } = entitlement.calculatedEntitlement;
        return {
            type: 'NUMERIC',
            isFallback: false,
            hasAccess: decision.hasAccess,
            accessDeniedReason: decision.accessDeniedReason,
            isUnlimited: hasUnlimitedUsage,
            value: usageLimit !== null && usageLimit !== void 0 ? usageLimit : undefined,
            feature: entitlement.calculatedEntitlement.feature
                ? Object.assign(Object.assign({}, entitlement.calculatedEntitlement.feature), { isMetered: false }) : undefined,
        };
    }
    mapMeteredEntitlement(entitlement, decision, requestedUsage) {
        const { hasUnlimitedUsage, usageLimit, hasSoftLimit } = entitlement.calculatedEntitlement;
        const { currentUsage, resetPeriod, usagePeriodAnchor, usagePeriodStart, usagePeriodEnd } = entitlement.featureUsage;
        return {
            type: 'METERED',
            isFallback: false,
            hasAccess: decision.hasAccess,
            accessDeniedReason: decision.accessDeniedReason,
            isUnlimited: hasUnlimitedUsage,
            hasSoftLimit: !!hasSoftLimit,
            usageLimit: usageLimit !== null && usageLimit !== void 0 ? usageLimit : undefined,
            currentUsage: currentUsage,
            requestedUsage: requestedUsage || 0,
            resetPeriod: resetPeriod !== null && resetPeriod !== void 0 ? resetPeriod : undefined,
            usagePeriodAnchor: (0, dateUtils_1.mapDate)(usagePeriodAnchor),
            usagePeriodStart: (0, dateUtils_1.mapDate)(usagePeriodStart),
            usagePeriodEnd: (0, dateUtils_1.mapDate)(usagePeriodEnd),
            nextResetDate: (0, dateUtils_1.mapDate)(usagePeriodEnd),
            feature: entitlement.calculatedEntitlement.feature
                ? Object.assign(Object.assign({}, entitlement.calculatedEntitlement.feature), { meterType: entitlement.calculatedEntitlement.feature.meterType || undefined, isMetered: true }) : undefined,
        };
    }
    getSubscriptionPrices(subscription) {
        return subscription.prices
            ? subscription.prices
                .filter((price) => !!price.price)
                .map((price) => this.mapPrice(price.price, price.usageLimit))
            : [];
    }
    mapCoupons(resultData) {
        return resultData.coupons.edges.map((x) => x.node).map((coupon) => this.mapCoupon(coupon));
    }
    mapPaymentDetails(customer) {
        const { defaultPaymentExpirationYear, defaultPaymentExpirationMonth, defaultPaymentMethodLast4Digits } = customer;
        if ((0, lodash_1.some)([defaultPaymentMethodLast4Digits, defaultPaymentExpirationMonth, defaultPaymentExpirationYear], (x) => x)) {
            return {
                expirationMonth: defaultPaymentExpirationMonth,
                expirationYear: defaultPaymentExpirationYear,
                last4Digits: defaultPaymentMethodLast4Digits,
            };
        }
        return undefined;
    }
    mapCoupon(coupon) {
        return {
            id: coupon.refId,
            name: coupon.name,
            description: coupon.description,
            metadata: coupon.additionalMetaData,
            discountValue: coupon.discountValue,
            percentOff: coupon.percentOff,
            amountsOff: coupon.amountsOff,
        };
    }
    mapPrice(pricing, usageLimit) {
        const { feature, price, billingId, billingModel, billingPeriod, minUnitQuantity, maxUnitQuantity, tiers, tiersMode, billingCountryCode, billingCadence, blockSize, } = pricing;
        const mappedPrice = {
            pricingModel: billingModel,
            billingPeriod,
            billingCadence,
            billingId,
            amount: price ? price.amount : null,
            currency: this.getPriceCurrency(pricing),
            tiers,
            tiersMode,
            minUnitQuantity,
            maxUnitQuantity,
            billingCountryCode,
            blockSize,
        };
        if (feature) {
            mappedPrice.feature = {
                featureId: feature.refId,
                displayName: feature.displayName,
                description: feature.description,
                units: feature.featureUnits,
                unitsPlural: feature.featureUnitsPlural,
                unitQuantity: usageLimit,
            };
        }
        return mappedPrice;
    }
    mapPlan(plan, order = 0) {
        return {
            id: plan.refId,
            order,
            billingId: plan.billingId,
            displayName: plan.displayName,
            description: plan.description,
            basePlan: plan.basePlan ? { id: plan.basePlan.refId, displayName: plan.basePlan.displayName } : undefined,
            entitlements: (0, lodash_1.map)(plan.entitlements, (entitlement) => this.mapPackageEntitlement(entitlement)),
            inheritedEntitlements: (0, lodash_1.map)(plan.inheritedEntitlements, (entitlement) => this.mapPackageEntitlement(entitlement)),
            pricePoints: (0, lodash_1.map)(plan.prices, (price) => this.mapPrice(price)),
            pricingType: plan.pricingType,
            defaultTrialConfig: this.mapDefaultTrialConfig(plan.defaultTrialConfig),
            compatibleAddons: this.mapCompatibleAddons(plan),
            compatiblePackageGroups: this.mapCompatiblePackageGroups(plan),
            product: {
                id: plan.product.refId,
                displayName: plan.product.displayName,
                description: plan.product.description,
                metadata: plan.product.additionalMetaData,
                downgradePlan: plan.product.productSettings.downgradePlan
                    ? {
                        id: plan.product.productSettings.downgradePlan.refId,
                        displayName: plan.product.productSettings.downgradePlan.displayName,
                    }
                    : undefined,
            },
            metadata: plan.additionalMetaData,
        };
    }
    mapProduct(product) {
        return {
            id: product.refId,
            displayName: product.displayName,
            description: product.description,
            metadata: product.additionalMetaData,
            downgradePlan: product.productSettings.downgradePlan
                ? {
                    id: product.productSettings.downgradePlan.refId,
                    displayName: product.productSettings.downgradePlan.displayName,
                }
                : undefined,
        };
    }
    mapProducts(resultData) {
        return resultData.products.edges.map((product) => product.node).map((product) => this.mapProduct(product));
    }
    mapDefaultTrialConfig(defaultTrialConfig) {
        if (!defaultTrialConfig) {
            return undefined;
        }
        return {
            duration: defaultTrialConfig === null || defaultTrialConfig === void 0 ? void 0 : defaultTrialConfig.duration,
            units: defaultTrialConfig === null || defaultTrialConfig === void 0 ? void 0 : defaultTrialConfig.units,
            budget: defaultTrialConfig.budget ? { limit: defaultTrialConfig.budget.limit } : undefined,
        };
    }
    mapCompatibleAddons(plan) {
        if (plan.pricingType === sdk_1.PricingType.Free || !plan.compatibleAddons) {
            return [];
        }
        const { compatibleAddons } = plan;
        const filteredCompatibleAddons = plan.pricingType === sdk_1.PricingType.Paid
            ? compatibleAddons.filter((addon) => addon.pricingType === sdk_1.PricingType.Paid)
            : compatibleAddons;
        return filteredCompatibleAddons.map((addon) => this.mapAddon(addon));
    }
    mapPackageEntitlement(entitlement) {
        const { feature } = entitlement;
        return {
            usageLimit: entitlement.usageLimit || 0,
            hasSoftLimit: entitlement.hasSoftLimit,
            feature: {
                id: feature.refId,
                featureType: feature.featureType,
                description: feature.description || '',
                meterType: feature.meterType || undefined,
                units: feature.featureUnits || undefined,
                unitsPlural: feature.featureUnitsPlural || undefined,
                displayName: feature.displayName,
                isMetered: (0, featureTypes_1.isMetered)(feature),
                metadata: feature.additionalMetaData,
            },
            hasUnlimitedUsage: entitlement.hasUnlimitedUsage,
            resetPeriod: entitlement.resetPeriod,
            hiddenFromWidgets: entitlement.hiddenFromWidgets,
            displayNameOverride: entitlement.displayNameOverride,
            isGranted: entitlement.isGranted,
        };
    }
    mapFullSubscriptions(subscriptions) {
        return subscriptions.map((subscription) => this.mapFullSubscription(subscription));
    }
    mapFullSubscription(subscription) {
        var _a;
        const { totalPrice } = subscription;
        const [planPrice] = subscription.prices || [];
        return {
            id: subscription.refId,
            payingCustomer: subscription.payingCustomer ? this.mapSlimCustomer(subscription.payingCustomer) : null,
            resource: subscription.resource ? this.mapResource(subscription.resource) : null,
            status: subscription.status,
            plan: this.mapPlan(subscription.plan),
            price: planPrice && totalPrice && planPrice.price
                ? this.mapTotalPrice(planPrice.price, totalPrice, planPrice.usageLimit)
                : null,
            prices: this.getSubscriptionPrices(subscription),
            totalPrice,
            pricingType: subscription.pricingType,
            addons: ((_a = subscription.addons) === null || _a === void 0 ? void 0 : _a.map(({ quantity, addon }) => ({
                quantity: quantity,
                addon: this.mapAddon(addon),
            }))) || [],
            startDate: (0, dateUtils_1.mapDate)(subscription.startDate),
            endDate: (0, dateUtils_1.mapDate)(subscription.endDate),
            trialEndDate: (0, dateUtils_1.mapDate)(subscription.trialEndDate),
            cancellationDate: (0, dateUtils_1.mapDate)(subscription.cancellationDate),
            currentBillingPeriodEnd: (0, dateUtils_1.mapDate)(subscription.currentBillingPeriodEnd),
            effectiveEndDate: (0, dateUtils_1.mapDate)(subscription.effectiveEndDate),
            metadata: subscription.additionalMetaData,
            billingId: subscription.billingId || undefined,
            billingLinkUrl: subscription.billingLinkUrl || undefined,
            experimentInfo: (0, lodash_1.omit)(subscription.experimentInfo, '__typename'),
            latestInvoice: this.mapLatestInvoice(subscription.latestInvoice),
            paymentCollection: subscription.paymentCollection,
            paymentCollectionMethod: subscription.paymentCollectionMethod || undefined,
            billingSyncError: subscription.billingSyncError || undefined,
            futureUpdates: subscription.futureUpdates,
        };
    }
    mapLatestInvoice(latestInvoice) {
        return latestInvoice
            ? Object.assign(Object.assign({}, latestInvoice), { createdAt: (0, dateUtils_1.mapDate)(latestInvoice.createdAt), updatedAt: (0, dateUtils_1.mapDate)(latestInvoice.updatedAt) })
            : undefined;
    }
    mapTotalPrice(pricing, totalPrice, usageLimit) {
        const { feature, billingModel, billingPeriod, tiers, tiersMode } = pricing;
        const mappedPrice = {
            pricingModel: billingModel,
            billingPeriod,
            amount: totalPrice.total.amount,
            grossAmount: totalPrice.subTotal.amount,
            currency: this.getPriceCurrency(pricing),
            tiersMode,
            tiers,
        };
        if (feature) {
            mappedPrice.feature = {
                featureId: feature.refId,
                displayName: feature.displayName,
                units: feature.featureUnits,
                unitsPlural: feature.featureUnitsPlural,
                unitQuantity: usageLimit,
            };
        }
        return mappedPrice;
    }
    mapDependencyAddon(addon) {
        return {
            refId: addon.refId,
            displayName: addon.displayName,
            description: addon.description || undefined,
        };
    }
    mapAddon(addon) {
        var _a;
        return {
            id: addon.refId,
            displayName: addon.displayName,
            billingId: addon.billingId,
            description: addon.description || '',
            entitlements: (0, lodash_1.map)(addon.entitlements, (x) => this.mapPackageEntitlement(x)),
            pricePoints: (0, lodash_1.map)(addon.prices, (price) => this.mapPrice(price)),
            pricingType: addon.pricingType,
            metadata: addon.additionalMetaData,
            maxQuantity: addon.maxQuantity || undefined,
            dependencies: ((_a = addon.dependencies) === null || _a === void 0 ? void 0 : _a.map((dependency) => this.mapDependencyAddon(dependency))) || [],
        };
    }
    mapPromotionalEntitlement(entitlement) {
        const { feature } = entitlement;
        return {
            status: entitlement.status,
            usageLimit: entitlement.usageLimit || 0,
            feature: {
                id: feature.refId,
                displayName: feature.displayName,
                description: feature.description || '',
                featureType: feature.featureType,
                meterType: feature.meterType || undefined,
                units: feature.featureUnits || undefined,
                unitsPlural: feature.featureUnitsPlural || undefined,
                isMetered: (0, featureTypes_1.isMetered)(feature),
                metadata: feature.additionalMetaData,
            },
            hasUnlimitedUsage: entitlement.hasUnlimitedUsage,
            expiresAt: entitlement.endDate,
            hasExpirationDate: !!entitlement.endDate,
            isVisible: entitlement.isVisible,
        };
    }
    mapReportUsageAck(data) {
        var _a;
        return {
            measurementId: data.id,
            customerId: data.customerId,
            resourceId: data.resourceId || undefined,
            featureId: data.featureId,
            currentUsage: (_a = data.currentUsage) !== null && _a !== void 0 ? _a : undefined,
            usagePeriodStart: (0, dateUtils_1.mapDate)(data.usagePeriodStart),
            usagePeriodEnd: (0, dateUtils_1.mapDate)(data.usagePeriodEnd),
            nextResetDate: (0, dateUtils_1.mapDate)(data.usagePeriodEnd),
        };
    }
    mapResource(resource) {
        return {
            id: resource.resourceId,
        };
    }
    mapPaywall(resultData) {
        const mappedPlans = this.mapPlans(resultData);
        const configuration = resultData === null || resultData === void 0 ? void 0 : resultData.paywall.configuration;
        const customer = (resultData === null || resultData === void 0 ? void 0 : resultData.paywall.customer) ? this.mapSlimCustomer(resultData === null || resultData === void 0 ? void 0 : resultData.paywall.customer) : null;
        const resource = (resultData === null || resultData === void 0 ? void 0 : resultData.paywall.resource) ? this.mapResource(resultData === null || resultData === void 0 ? void 0 : resultData.paywall.resource) : null;
        const activeSubscriptions = (resultData === null || resultData === void 0 ? void 0 : resultData.paywall.activeSubscriptions)
            ? this.mapFullSubscriptions(resultData === null || resultData === void 0 ? void 0 : resultData.paywall.activeSubscriptions)
            : null;
        return {
            plans: mappedPlans,
            configuration,
            customer,
            resource,
            activeSubscriptions,
            currency: resultData.paywall.currency,
        };
    }
    mapPlans(resultData) {
        var _a;
        const plans = ((_a = resultData === null || resultData === void 0 ? void 0 : resultData.paywall) === null || _a === void 0 ? void 0 : _a.plans) || [];
        return plans.map((plan, index) => this.mapPlan(plan, index));
    }
    mapTaxFields(fragment) {
        if (!fragment.tax || !fragment.taxDetails) {
            return {};
        }
        return {
            tax: this.mapMoney(fragment.tax),
            taxDetails: {
                displayName: fragment.taxDetails.displayName,
                percentage: fragment.taxDetails.percentage,
                inclusive: fragment.taxDetails.inclusive,
            },
        };
    }
    mapSubscriptionPreview(fragment) {
        const { subscription, proration, billingPeriodRange } = fragment;
        return Object.assign(Object.assign(Object.assign({ total: this.mapMoney(fragment.total), totalExcludingTax: this.mapMoney(fragment.totalExcludingTax), subTotal: this.mapMoney(fragment.subTotal) }, this.mapTaxFields(fragment)), (fragment.discount ? { discount: this.mapDiscount(fragment.discount) } : {})), { billingPeriodRange: {
                start: billingPeriodRange.start ? new Date(billingPeriodRange.start) : undefined,
                end: billingPeriodRange.end ? new Date(billingPeriodRange.end) : undefined,
            }, proration: proration
                ? {
                    credit: this.mapMoney(proration.credit),
                    debit: this.mapMoney(proration.debit),
                    netAmount: this.mapMoney(proration.netAmount),
                    prorationDate: new Date(proration.prorationDate),
                }
                : undefined, subscription: subscription
                ? {
                    total: this.mapMoney(subscription.total),
                    totalExcludingTax: this.mapMoney(subscription.totalExcludingTax),
                    subTotal: this.mapMoney(subscription.subTotal),
                    tax: this.mapMoney(subscription.tax),
                }
                : undefined });
    }
    mapCredits(fragment) {
        return {
            initial: this.mapMoney(fragment.initial),
            used: this.mapMoney(fragment.used),
            remaining: this.mapMoney(fragment.remaining),
        };
    }
    mapSubscriptionPreviewV2(fragment) {
        const { immediateInvoice, recurringInvoice, billingPeriodRange, hasScheduledUpdates, isPlanDowngrade } = fragment;
        return {
            immediateInvoice: Object.assign(Object.assign({}, this.mapSubscriptionPreviewInvoice(immediateInvoice)), { proration: immediateInvoice.proration
                    ? {
                        credit: this.mapMoney(immediateInvoice.proration.credit),
                        debit: this.mapMoney(immediateInvoice.proration.debit),
                        netAmount: this.mapMoney(immediateInvoice.proration.netAmount),
                        prorationDate: new Date(immediateInvoice.proration.prorationDate),
                        hasProrations: immediateInvoice.proration.hasProrations || undefined,
                    }
                    : undefined, credits: immediateInvoice.credits ? this.mapCredits(immediateInvoice.credits) : undefined }),
            recurringInvoice: recurringInvoice
                ? Object.assign({}, this.mapSubscriptionPreviewInvoice(recurringInvoice)) : undefined,
            billingPeriodRange: {
                start: billingPeriodRange.start && new Date(billingPeriodRange.start),
                end: billingPeriodRange.end && new Date(billingPeriodRange.end),
            },
            isPlanDowngrade: !!isPlanDowngrade,
            hasScheduledUpdates: !!hasScheduledUpdates,
        };
    }
    mapSubscriptionPreviewInvoice(fragment) {
        return Object.assign(Object.assign({ total: this.mapMoney(fragment.total), subTotal: this.mapMoney(fragment.subTotal), totalExcludingTax: this.mapMoney(fragment.totalExcludingTax), discount: fragment.discount ? this.mapMoney(fragment.discount) : undefined }, (fragment.discountDetails ? { discountDetails: this.mapDiscount(fragment.discountDetails) } : {})), this.mapTaxFields(fragment));
    }
    mapDiscount(discount) {
        const { type, value, durationType, durationInMonths } = discount;
        return Object.assign({ type, value, durationType }, (durationInMonths ? { durationInMonths } : {}));
    }
    mapMoney(fragment) {
        return {
            amount: fragment.amount,
            currency: fragment.currency,
        };
    }
    mapUsageHistory(usageHistory) {
        return usageHistory.usageMeasurements.map(({ date, value, isResetPoint }) => {
            return {
                date: new Date(date),
                value: value,
                isResetPoint: !!isResetPoint,
            };
        });
    }
    mapCustomerStatistics(customer) {
        return {
            statistics: {
                activeSubscriptionsByPricingType: customer.statistics
                    ? customer.statistics.activeSubscriptionsByPricingType.map((stat) => (0, lodash_1.omit)(stat, '__typename'))
                    : [],
            },
        };
    }
    getPriceCurrency({ price, tiers }) {
        var _a, _b;
        return (price === null || price === void 0 ? void 0 : price.currency) || ((_a = tiers === null || tiers === void 0 ? void 0 : tiers[0].unitPrice) === null || _a === void 0 ? void 0 : _a.currency) || ((_b = tiers === null || tiers === void 0 ? void 0 : tiers[0].flatPrice) === null || _b === void 0 ? void 0 : _b.currency) || sdk_1.Currency.Usd;
    }
    mapCompatiblePackageGroups(plan) {
        if (plan.pricingType === sdk_1.PricingType.Free || !plan.compatiblePackageGroups) {
            return [];
        }
        const { compatiblePackageGroups, pricingType } = plan;
        return compatiblePackageGroups.map((group) => {
            const { packageGroupId, displayName, addons, options } = group;
            return {
                packageGroupId,
                displayName,
                addons: this.mapCompatibleAddons({ compatibleAddons: addons, pricingType }),
                options: {
                    minItems: (options === null || options === void 0 ? void 0 : options.minItems) || undefined,
                    freeItems: (options === null || options === void 0 ? void 0 : options.freeItems) || undefined,
                },
            };
        });
    }
}
exports.ModelMapper = ModelMapper;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kZWxNYXBwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvTW9kZWxNYXBwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsZ0VBa0NnRDtBQUNoRCxzQ0FxQ21CO0FBR25CLG1DQUF5QztBQUN6QyxpREFBMkM7QUFDM0MsMkNBQXNDO0FBRXRDLE1BQU0sV0FBVztJQUFqQjtRQWdIRSxvQkFBZSxHQUFHLENBQUMsUUFBOEIsRUFBZ0IsRUFBRTtZQUNqRSxPQUFPO2dCQUNMLEVBQUUsRUFBRSxRQUFRLENBQUMsS0FBSztnQkFDbEIsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLElBQUksU0FBUztnQkFDaEMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLLElBQUksU0FBUztnQkFDbEMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxTQUFTLElBQUksU0FBUztnQkFDMUMsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7Z0JBQ3ZDLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUN2QyxRQUFRLEVBQUUsUUFBUSxDQUFDLGtCQUFrQjtnQkFDckMsd0JBQXdCLEVBQUUsUUFBUSxDQUFDLHdCQUF3QjthQUM1RCxDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRUYsMkJBQXNCLEdBQUcsQ0FBQyx3QkFBbUQsRUFBdUIsRUFBRTtZQUNwRyxNQUFNLFFBQVEsR0FBaUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyx3QkFBd0IsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV6RyxNQUFNLFlBQVksR0FBNkIsd0JBQXdCLENBQUMsaUJBQWlCLENBQUMsWUFBWTtnQkFDcEcsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUM7Z0JBQ25GLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFFZCxPQUFP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